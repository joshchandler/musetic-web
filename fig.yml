# Musetic Fig config
#
# To get started:
#   $ pip install fig
#   $ fig build
#   $ fig up
#   $ fig run web python manage.py syncdb
#   $ open http://192.168.59.103:8000/  # For boot2docker
#   $ open http://127.0.0.1:8000/  # For native docker
#
# You can also run manage.py commands easily like so:
#   $ fig run web python manage.py dumpdata -a > database.json

database:
  image: postgres:9.3
redis:
  image: redis:latest
  mem_limit: "64m"
memcached:
  image: fedora/memcached:latest
  mem_limit: "64m"
web:
  build: .
  command: python manage.py runserver 0.0.0.0:8000
  ports:
    - "8000:8000"
  volumes:
    - .:/var/www/musetic-web
  environment:
    DOCKER_DEV: true
  links:
    - database
    - redis
    - memcached
celeryworker:
  build: .
  command: python manage.py celery worker
  volumes_from:
    - web
  links:
    - database
    - redis
    - web
    - memcached
  environment:
    DOCKER_DEV: true
celerybeat:
  build: .
  command: python manage.py celery beat
  volumes_from:
    - web
  links:
    - database
    - redis
    - web
    - memcached
  environment:
    DOCKER_DEV: true
celerycam:
  build: .
  command: python manage.py celerycam --pidfile /tmp/celerycam.pid
  volumes_from:
    - web
  links:
    - database
    - memcached
    - redis
    - web
  environment:
    DOCKER_DEV: true
